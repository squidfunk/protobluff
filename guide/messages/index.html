



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="A modular Protocol Buffers implementation for C">
      
      
        <link rel="canonical" href="https://squidfunk.github.io/protobluff/guide/messages/">
      
      
        <meta name="author" content="Martin Donath">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.5, mkdocs-material-2.9.4">
    
    
      
        <title>Working with messages - protobluff</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.451f80e5.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.22915126.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#overview" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://squidfunk.github.io/protobluff/" title="protobluff" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                protobluff
              </span>
              <span class="md-header-nav__topic">
                Working with messages
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/squidfunk/protobluff" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      squidfunk/protobluff
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="About" class="md-tabs__link">
        About
      </a>
    
  </li>

      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../runtimes/" title="Developer guide" class="md-tabs__link md-tabs__link--active">
          Developer guide
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://squidfunk.github.io/protobluff/" title="protobluff" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    protobluff
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/squidfunk/protobluff" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      squidfunk/protobluff
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../getting-started/" title="Getting started" class="md-nav__link">
      Getting started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../design-rationale/" title="Design rationale" class="md-nav__link">
      Design rationale
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../similar-projects/" title="Similar projects" class="md-nav__link">
      Similar projects
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Developer guide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Developer guide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../runtimes/" title="Choosing a runtime" class="md-nav__link">
      Choosing a runtime
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../buffers-and-journals/" title="Buffers and journals" class="md-nav__link">
      Buffers and journals
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Working with messages
      </label>
    
    <a href="./" title="Working with messages" class="md-nav__link md-nav__link--active">
      Working with messages
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-a-message-type" title="Defining a message type" class="md-nav__link">
    Defining a message type
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-message" title="Creating a message" class="md-nav__link">
    Creating a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-from-a-message" title="Reading from a message" class="md-nav__link">
    Reading from a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-to-a-message" title="Writing to a message" class="md-nav__link">
    Writing to a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#erasing-from-a-message" title="Erasing from a message" class="md-nav__link">
    Erasing from a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freeing-a-message" title="Freeing a message" class="md-nav__link">
    Freeing a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dumping-a-message" title="Dumping a message" class="md-nav__link">
    Dumping a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" title="Error handling" class="md-nav__link">
    Error handling
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../scalar-types/" title="Scalar types" class="md-nav__link">
      Scalar types
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../repeated-fields/" title="Repeated fields" class="md-nav__link">
      Repeated fields
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../error-handling/" title="Error handling" class="md-nav__link">
      Error handling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../allocators/" title="Custom allocators" class="md-nav__link">
      Custom allocators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../miscellaneous/" title="Miscellaneous" class="md-nav__link">
      Miscellaneous
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" title="Overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-a-message-type" title="Defining a message type" class="md-nav__link">
    Defining a message type
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-a-message" title="Creating a message" class="md-nav__link">
    Creating a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reading-from-a-message" title="Reading from a message" class="md-nav__link">
    Reading from a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-to-a-message" title="Writing to a message" class="md-nav__link">
    Writing to a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#erasing-from-a-message" title="Erasing from a message" class="md-nav__link">
    Erasing from a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#freeing-a-message" title="Freeing a message" class="md-nav__link">
    Freeing a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dumping-a-message" title="Dumping a message" class="md-nav__link">
    Dumping a message
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#error-handling" title="Error handling" class="md-nav__link">
    Error handling
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Working with messages</h1>
                
                <h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h2>
<p>As Protocol Buffers is a data interchange format, messages and message types
are at the very core of protobluff. Message types are logically grouped
together and described in a <code>.proto</code> schema file in a language-neutral format.
From this schema file, protobluff generates bindings for the C language, so
that wire-encoded messages of the respective type can be easily processed,
omitting the necessity for manual parsing like it is with schema-less message
formats. However, protobluff does not generate structs from Protocol Buffers
definitions like most of the implementations for the C language do, but rather
descriptors that are used to dynamically alter messages.</p>
<h2 id="defining-a-message-type">Defining a message type<a class="headerlink" href="#defining-a-message-type" title="Permanent link">&para;</a></h2>
<p>Protocol Buffers message definitions are written in a declarative language.
For further explanations, we'll use the basic example from the
<a href="https://developers.google.com/protocol-buffers/docs/overview#how-do-they-work">Protocol Buffers Developer Guide</a> that defines a simple message with information about a person in a file
called <code>person.proto</code>:</p>
<div class="codehilite"><pre><span></span><span class="kd">message</span> <span class="nc">Person</span> <span class="p">{</span>
  <span class="kd">message</span> <span class="nc">PhoneNumber</span> <span class="p">{</span>
    <span class="kd">enum</span> <span class="n">PhoneType</span> <span class="p">{</span>
      <span class="na">MOBILE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="na">HOME</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="na">WORK</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">required</span> <span class="kt">string</span> <span class="na">number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">optional</span> <span class="n">PhoneType</span> <span class="na">type</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">[</span><span class="k">default</span> <span class="o">=</span> <span class="n">HOME</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="k">required</span> <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">required</span> <span class="kt">int32</span> <span class="na">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="k">optional</span> <span class="kt">string</span> <span class="na">email</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
  <span class="k">repeated</span> <span class="n">PhoneNumber</span> <span class="na">phone</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p>After defining the message type, the required bindings must be generated. The
code generator can be invoked with the following command:</p>
<div class="codehilite"><pre><span></span>protoc --protobluff_out<span class="o">=</span>. person.proto
</pre></div>

<p>This will generate two files, namely <code>person.pb.h</code> and <code>person.pb.c</code> in the
directory specified for the <code>--protobluff_out</code> flag. The header file must be
included in the parts of the application where the bindings are used, the
source file must be compiled with the application. Furthermore, the protobluff
runtime must be linked against the application. See the notes on
<a href="../../guide/runtimes/">choosing a runtime</a> for further details on how
to link protobluff.</p>
<p>The resulting bindings in <code>person.pb.h</code> will contain bindings for the lite and
full runtime that are defined as inline functions using the low-level interface
and look like this (excerpt):</p>
<div class="codehilite"><pre><span></span><span class="p">...</span>
<span class="cm">/* Person : create */</span>
<span class="n">PB_WARN_UNUSED_RESULT</span>
<span class="n">PB_INLINE</span> <span class="n">pb_message_t</span>
<span class="n">person_create</span><span class="p">(</span><span class="n">pb_journal_t</span> <span class="o">*</span><span class="n">journal</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="n">pb_message_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person_descriptor</span><span class="p">,</span> <span class="n">journal</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Person : destroy */</span>
<span class="n">PB_INLINE</span> <span class="kt">void</span>
<span class="n">person_destroy</span><span class="p">(</span><span class="n">pb_message_t</span> <span class="o">*</span><span class="n">message</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">pb_message_descriptor</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">person_descriptor</span><span class="p">);</span>
  <span class="k">return</span> <span class="nf">pb_message_destroy</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Person.name : get */</span>
<span class="n">PB_WARN_UNUSED_RESULT</span>
<span class="n">PB_INLINE</span> <span class="n">pb_error_t</span>
<span class="n">person_get_name</span><span class="p">(</span><span class="n">pb_message_t</span> <span class="o">*</span><span class="n">message</span><span class="p">,</span> <span class="n">pb_string_t</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">pb_message_descriptor</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">person_descriptor</span><span class="p">);</span>
  <span class="k">return</span> <span class="nf">pb_message_get</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Person.name : put */</span>
<span class="n">PB_WARN_UNUSED_RESULT</span>
<span class="n">PB_INLINE</span> <span class="n">pb_error_t</span>
<span class="n">person_put_name</span><span class="p">(</span><span class="n">pb_message_t</span> <span class="o">*</span><span class="n">message</span><span class="p">,</span> <span class="k">const</span> <span class="n">pb_string_t</span> <span class="o">*</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">assert</span><span class="p">(</span><span class="n">pb_message_descriptor</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">person_descriptor</span><span class="p">);</span>
  <span class="k">return</span> <span class="nf">pb_message_put</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
<span class="p">...</span>
</pre></div>

<p>Why inline functions? Because there's no overhead when compiling the program,
as all function calls are only thin wrappers around the low-level interface of
protobluff. While in development mode descriptors are checked with assertions
for the correct type, code for production should be compiled with the flag
<code>-DNDEBUG</code>, which will remove all assertions.</p>
<h2 id="creating-a-message">Creating a message<a class="headerlink" href="#creating-a-message" title="Permanent link">&para;</a></h2>
<p>Using the full runtime, a message can easily be created with a valid journal:</p>
<div class="codehilite"><pre><span></span><span class="n">pb_message_t</span> <span class="n">person</span> <span class="o">=</span> <span class="n">person_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">journal</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pb_message_valid</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person</span><span class="p">))</span> <span class="p">{</span>
  <span class="cm">/* Error creating person message */</span>
<span class="p">}</span>
</pre></div>

<h2 id="reading-from-a-message">Reading from a message<a class="headerlink" href="#reading-from-a-message" title="Permanent link">&para;</a></h2>
<p>To read the value of a field, the generated accessors can be used:</p>
<div class="codehilite"><pre><span></span><span class="n">pb_string_t</span> <span class="n">name</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="n">person_get_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">))</span> <span class="p">{</span>
  <span class="cm">/* Error reading name from person message */</span>
<span class="p">}</span>
</pre></div>

<p>Reading values from a message is only allowed for non-repeated scalar types.
Messages need to be accessed through <code>pb_message_create_within</code>, repeated
fields must be accessed through cursors – see the documentation on
<a href="../../guide/repeated-fields/">repeated fields</a> for more information.</p>
<p>If the message doesn't contain a value for the respective field and no
default value is set, the function will return <code>PB_ERROR_ABSENT</code>.</p>
<h2 id="writing-to-a-message">Writing to a message<a class="headerlink" href="#writing-to-a-message" title="Permanent link">&para;</a></h2>
<p>Writing a value to a field is equally straight forward:</p>
<div class="codehilite"><pre><span></span><span class="n">pb_string_t</span> <span class="n">name</span> <span class="o">=</span> <span class="n">pb_string_init</span><span class="p">(</span><span class="s">&quot;John Doe&quot;</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">person_put_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">))</span> <span class="p">{</span>
  <span class="cm">/* Error writing name to person message */</span>
<span class="p">}</span>
</pre></div>

<p>Writing a value or submessage to a message is translated into a low-level call
of <code>pb_message_put</code> which allows all Protocol Buffer types to be written.
However, writing a repeated field or submessage will always create (append) a
new instance. If a specific instance should be updated, cursors must be used.
Again, see the documentation on <a href="../../guide/repeated-fields/">repeated fields</a> for
more information.</p>
<h2 id="erasing-from-a-message">Erasing from a message<a class="headerlink" href="#erasing-from-a-message" title="Permanent link">&para;</a></h2>
<p>Erasing a field can be done with:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">person_erase_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person</span><span class="p">))</span> <span class="p">{</span>
  <span class="cm">/* Error erasing name from person message */</span>
<span class="p">}</span>
</pre></div>

<p>Erasing a field or submessage from a message is an idempotent operation,
regardless of whether the field existed or not. Erasing a repeated field or
submessage will always erase <strong>all occurrences</strong>. In order to erase specific
occurrences of a field, a cursor must be used.</p>
<h2 id="freeing-a-message">Freeing a message<a class="headerlink" href="#freeing-a-message" title="Permanent link">&para;</a></h2>
<p>Burn after reading -- though messages don't perform any dynamic allocations,
it is recommended to destroy them after use:</p>
<div class="codehilite"><pre><span></span><span class="n">person_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person</span><span class="p">);</span>
</pre></div>

<p>This will keep your application future-proof.</p>
<h2 id="dumping-a-message">Dumping a message<a class="headerlink" href="#dumping-a-message" title="Permanent link">&para;</a></h2>
<p>For debugging purposes, messages can be dumped to inspect the underlying wire
format:</p>
<div class="codehilite"><pre><span></span><span class="n">pb_message_dump</span><span class="p">(</span><span class="o">&amp;</span><span class="n">person</span><span class="p">);</span>
</pre></div>

<p>This will write something like the following to the terminal, denoting the
content and offsets of a message within the context of other messages:</p>
<div class="codehilite"><pre><span></span>   0  offset start
  73  offset end
  73  length
----  ---------------------------------------  -------------------
   0   10   8  74 111 104 110  32  68 111 101  . . J o h n   D o e
  10   16 210   9  26  16 106 100 111 101  64  . . . . . j d o e @
  20  101 120  97 109 112 108 101  46  99 111  e x a m p l e . c o
  30  109  34  19  10  15  43  49  45  53  52  m &quot; . . . + 1 - 5 4
  40   49  45  55  53  52  45  51  48  49  48  1 - 7 5 4 - 3 0 1 0
  50   16   1  34  19  10  15  43  49  45  53  . . &quot; . . . + 1 - 5
  60   52  49  45  50  57  51  45  56  50  50  4 1 - 2 9 3 - 8 2 2
  70   56  16   0                              8 . .
</pre></div>

<h2 id="error-handling">Error handling<a class="headerlink" href="#error-handling" title="Permanent link">&para;</a></h2>
<p>All functions and macros that create new structures or alter the contents of
messages and return the type <code>pb_error_t</code> should be checked for errors. See
the section on <a href="../../guide/error-handling">error handling</a> for a detailed
description and semantics of all possible errors.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../buffers-and-journals/" title="Buffers and journals" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Buffers and journals
              </span>
            </div>
          </a>
        
        
          <a href="../scalar-types/" title="Scalar types" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Scalar types
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2013 - 2016 Martin Donath
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="http://struct.cc" class="md-footer-social__link fa fa-globe"></a>
    
      <a href="https://github.com/squidfunk" class="md-footer-social__link fa fa-github-alt"></a>
    
      <a href="https://twitter.com/squidfunk" class="md-footer-social__link fa fa-twitter"></a>
    
      <a href="https://linkedin.com/in/squidfunk" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.30f6b8b1.js"></script>
      
      <script>app.initialize({version:"0.17.5",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>